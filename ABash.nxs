{"type":"group","name":"ABash","enabled":true,"items":[{"type":"function","name":"onLoad","enabled":true,"code":"display_notice(\"Loading ABash\", \"green\");\n\nconst abash = {\n\tversion: \"2.4.2\",\n    separator: \"\",\n\n\tstartUp() {\n\t\tconsole.log(\"ABash loaded successfully\");\n        send_command(\"config commandseparator\");\n\t\t\n\t\t// declare namespace variables\n\t\t//const version = 1.5;\n\t\tlet currentArea = \"\";\n\t\tlet prioList = {};\n\t\tlet classAttacks = {};\n\t\tlet myClass;\n\t\tabash.myClass = GMCP.Status.class;\n\t\tconsole.log(\"GMCP class: \" + GMCP.Status.class);\n\t\tconsole.log(\"ABash class set to: \" + abash.myClass);\n\t\tlet bashAttack;\n      \n      rageTable = {\n        'Red Dragon':{\n          smallAttack:\"Overwhelm\",\n          bigAttack:\"Dragonblaze\",\n          shieldRaze:\"Melt\"\n        },\n\t\t'Green Dragon':{\n          smallAttack:\"Dragonspit\",\n          bigAttack:\"Override\",\n          shieldRaze:\"Deteriorate\"\n        },\n\t\t'Black Dragon':{\n          smallAttack:\"Dragonspit\",\n          bigAttack:\"Override\",\n          shieldRaze:\"Dissolve\"\n        },\n\t\t'Blue Dragon':{\n          smallAttack:\"Dragonchill\",\n          bigAttack:\"Override\",\n          shieldRaze:\"Frostrive\"\n        },\n\t\t'Silver Dragon':{\n          smallAttack:\"Overwhelm\",\n          bigAttack:\"Dragonspark\",\n          shieldRaze:\"Splinter\"\n        },\n\t\t'Gold Dragon':{\n          smallAttack:\"Overwhelm\",\n          bigAttack:\"Psiblast\",\n          shieldRaze:\"Psishatter\"\n        },\n\t\t'earth Elemental Lord':{\n          smallAttack:\"Smash\",\n          bigAttack:\"Flurry\",\n          shieldRaze:\"Charge\"\n        },\n\t\t'air Elemental Lord':{\n          smallAttack:\"Bolt\",\n          bigAttack:\"Pressurewave\",\n          shieldRaze:\"Drill\"\n        },\n\t\t'fire Elemental Lord':{\n          smallAttack:\"Engulf\",\n          bigAttack:\"Devastation\",\n          shieldRaze:\"Wires\"\n        },\n\t\t'water Elemental Lord':{\n          smallAttack:\"Icicles\",\n          bigAttack:\"Needlerain\",\n          shieldRaze:\"Aquahammer\"\n        },\n'earth Elemental Lady':{\n          smallAttack:\"Smash\",\n          bigAttack:\"Flurry\",\n          shieldRaze:\"Charge\"\n        },\n\t\t'air Elemental Lady':{\n          smallAttack:\"Bolt\",\n          bigAttack:\"Pressurewave\",\n          shieldRaze:\"Drill\"\n        },\n\t\t'fire Elemental Lady':{\n          smallAttack:\"Engulf\",\n          bigAttack:\"Devastation\",\n          shieldRaze:\"Wires\"\n        },\n\t\t'water Elemental Lady':{\n          smallAttack:\"Icicles\",\n          bigAttack:\"Needlerain\",\n          shieldRaze:\"Aquahammer\"\n        },\n\t\t'Alchemist':{\n          smallAttack:\"Miasma\",\n          bigAttack:\"Magnesium\",\n          shieldRaze:\"Caustic\"\n        },\n\t\t'Apostate':{\n          smallAttack:\"Stare\",\n          bigAttack:\"Burrow\",\n          shieldRaze:\"Pierce\"\n        },\n\t\t'Bard':{\n          smallAttack:\"Moulinet\",\n          bigAttack:\"Howlslash\",\n          shieldRaze:\"Resonance\"\n        },\n\t\t'Blademaster':{\n          smallAttack:\"Leapstrike\",\n          bigAttack:\"Spinslash\",\n          shieldRaze:\"Shatter\"\n        },\n\t\t'Depthswalker':{\n          smallAttack:\"Drain\",\n          bigAttack:\"Lash\",\n          shieldRaze:\"Nakail\"\n        },\n\t\t'Druid':{\n          smallAttack:\"Strangle\",\n          bigAttack:\"Ravage\",\n          shieldRaze:\"Vinecrack\"\n        },\n\t\t'Infernal':{\n          smallAttack:\"Ravage\",\n          bigAttack:\"Spike\",\n          shieldRaze:\"Shiver\"\n        },\n\t\t'Jester':{\n          smallAttack:\"Noogie\",\n          bigAttack:\"Ensconce\",\n          shieldRaze:\"Jacks\"\n        },\n\t\t'Magi':{\n          smallAttack:\"Windlash\",\n          bigAttack:\"Squeeze\",\n          shieldRaze:\"Disintegrate\"\n        },\n\t\t'Monk':{\n          smallAttack:\"Spinningbackfist\",\n          bigAttack:\"Tornadokick\",\n          shieldRaze:\"Splinterkick\"\n        },\n\t\t'Occultist':{\n          smallAttack:\"Harry\",\n          bigAttack:\"Chaosgate\",\n          shieldRaze:\"Ruin\"\n        },\n\t\t'Paladin':{\n          smallAttack:\"Harrow\",\n          bigAttack:\"Shock\",\n          shieldRaze:\"\"\n        },\n\t\t'Pariah':{\n          smallAttack:\"Boil\",\n          bigAttack:\"Feast\",\n          shieldRaze:\"Scour\"\n        },\n\t\t'Priest':{\n          smallAttack:\"Torment\",\n          bigAttack:\"Harrow\",\n          shieldRaze:\"Crack\"\n        },\n\t\t'Psion':{\n          smallAttack:\"Barbedblade\",\n          bigAttack:\"Devastate\",\n          shieldRaze:\"Pulverise\"\n        },\n\t\t'Runewarden':{\n          smallAttack:\"Collide\",\n          bigAttack:\"Onslaught\",\n          shieldRaze:\"\"\n        },\n\t\t'Sentinel':{\n          smallAttack:\"Pester\",\n          bigAttack:\"Skewer\",\n          shieldRaze:\"\"\n        },\n\t\t'Serpent':{\n          smallAttack:\"Thrash\",\n          bigAttack:\"Throatrip\",\n          shieldRaze:\"\"\n        },\n\t\t'Shaman':{\n          smallAttack:\"Corruption\",\n          bigAttack:\"Haemorrhage\",\n          shieldRaze:\"\"\n        },\n\t\t'Sylvan':{\n          smallAttack:\"Torrent\",\n          bigAttack:\"Stonevine\",\n          shieldRaze:\"Thornpierce\"\n        },\n\t\t'Unnameable':{\n          smallAttack:\"Shriek\",\n          bigAttack:\"Destroy\",\n          shieldRaze:\"Sunder\"\n        },\n      }\n\n\t\t// In case of package reset, unsubscribe from all associated events\n\t\teventBus.unsubscribe('denizenSlain', 'denSlain');\n\t\teventBus.unsubscribe('affRemProne', 'attackReady');\n\t\teventBus.unsubscribe('affRemParalysis', 'attackReady');\n\t\teventBus.unsubscribe('affRemBound', 'attackReady');\n\t\teventBus.unsubscribe('affRemEntangled', 'attackReady');\n\t\teventBus.unsubscribe('affRemTransfixation', 'attackReady');\n\t\teventBus.unsubscribe('affRemWebbed', 'attackReady');\n\t\teventBus.unsubscribe('affRemStunned', 'attackReady');\n\t\teventBus.unsubscribe('onEq', 'attackReady');\n\t\teventBus.unsubscribe('onBal', 'attackReady');\n\t\teventBus.unsubscribe('onClassChange', \"checkClassAttack\");\n\n\t\tif(!nexusclient.variables().get(\"basharrrPrioList\")) {\n\t\t\tnexusclient.display_notice(\"There's no bashing prio list!!!\", \"red\");\n\t\t\tabash.prioList = {};\n\t\t\tnexusclient.variables().set(\"basharrrPrioList\", abash.prioList);\n\t\t} else {\n\t\t\tabash.prioList = nexusclient.variables().get(\"basharrrPrioList\");\n\t\t\tnexusclient.display_notice(\"Bashing Prio List loaded into repo!\", \"green\");\n\t\t}\n\n\t\tif(!nexusclient.variables().get(\"abashClassAttacks\")) {\n\t\t\tabash.classAttacks = {};\n\t\t\tnexusclient.variables().set(\"abashClassAttacks\", abash.classAttacks);\n\t\t} else {\n\t\t\tabash.classAttacks = nexusclient.variables().get(\"abashClassAttacks\");\n\t\t}\n\n\t\tif(abash.myClass in abash.classAttacks) {\n\t\t\tabash.bashAttack = abash.classAttacks[abash.myClass];\n\t\t} else {\n\t\t\tabash.bashAttack = \"kill\";\n\t\t}\n\t\tconsole.log(\"myClass: \" + abash.myClass);\n\t\tconsole.log(\"ABash bashing attack: \" + abash.bashAttack);\n\n\t\t// Trigger: When a denizen is slain\n\t\tconst denSlain = function(denizen) {\n\t\t\tlet slainDenizen = denizen;\n\t\t\tabash.currentArea = nexusclient.datahandler().GMCP.Location.area;\n\n\t\t\tif(abash.prioList[abash.currentArea]) {\n\t\t\t\t// Area already exists in prio list\n\t\t\t\tlet denizenList = abash.prioList[abash.currentArea];\n\t\t\t\tconsole.log(denizenList);\n\t\t\t\tif(!denizenList.includes(slainDenizen)) {\n\t\t\t\t\tnexusclient.display_notice(\"[ABASH]: New denizen added\", \"yellow\");\n\t\t\t\t\tdenizenList.push(slainDenizen);\n\t\t\t\t\tabash.prioList[abash.currentArea] = denizenList;\n\t\t\t\t\tnexusclient.variables().set(\"basharrrPrioList\", abash.prioList);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Area does not exist in prio list\n\t\t\t\tlet denizenList = [];\n\t\t\t\tdenizenList.push(slainDenizen);\n\t\t\t\tabash.prioList[abash.currentArea] = denizenList;\n\t\t\t\tconsole.log(abash.prioList);\n\t\t\t\tnexusclient.variables().set(\"basharrrPrioList\", abash.prioList);\n\t\t\t\tnexusclient.display_notice(\"[ABASH]: New area added\", \"yellow\");\n\t\t\t\tnexusclient.display_notice(\"[ABASH]: New denizen added\", \"yellow\");\n\t\t\t}\n\n\t\t\trun_function(\"attackThings\", {}, \"ABash\");\n\t\t}\n\t\teventBus.subscribe('denizenSlain', denSlain, 'denSlain');\n\n\t\t// Trigger: Main attack trigger\n\t\tconst attackReady = function() {\n\t\t\tabash.commitAttack();\n\t\t}\n\t\teventBus.subscribe('affRemProne', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemParalysis', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemBound', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemEntangled', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemTransfixation', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemWebbed', attackReady, 'attackReady');\n\t\teventBus.subscribe('affRemStunned', attackReady, 'attackReady');\n\t\teventBus.subscribe('onEq', attackReady, 'attackReady');\n\t\teventBus.subscribe('onBal', attackReady, 'attackReady');\n\n\t\tconst checkClassAttack = function() {\n\t\t\tabash.myClass = nexusclient.datahandler().GMCP.Status.class;\n\t\t\tnexusclient.display_notice(\"Current Class: \" + abash.myClass, \"white\");\n\t\t\tif(abash.myClass in abash.classAttacks) {\n\t\t\t\tabash.bashAttack = abash.classAttacks[abash.myClass];\n\t\t\t} else {\n\t\t\t\tabash.bashAttack = \"kill\";\n\t\t\t}\n\t\t\tnexusclient.display_notice(\"Bashing Attack: \", \"white\", \"\", abash.bashAttack, \"yellow\");\n\t\t\tif(abash.bashAttack == \"kill\") {\n\t\t\t\tnexusclient.display_notice(\"To set your class bashing attack use ABASH SET ATTACK <attack>\", \"white\");\n\t\t\t}\n\t\t}; // End checkClassAttack()\n\t\teventBus.subscribe('onClassChange', checkClassAttack, 'checkClassAttack');\n      \n      eventBus.unsubscribe('denizenShieldRaised', 'denizenShielded');\n      \n      const denizenShielded = function() {\n        for (let i = 2; i <= 7; i++) {\n          let buttonStr = \"button\" + i;\n          //console.log(abash.rageTable[GMCP.Status.class]);\n          if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].shieldRaze) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n            }\n          }\n        }\n      }; // End denizenShielded()\n      \n      eventBus.subscribe('denizenShieldRaised', denizenShielded, 'denizenShielded');\n\n      eventBus.unsubscribe('buttonChange', 'evalRageAttack');\n      \n      const evalRageAttack = function() {\n        for (let i = 2; i <= 7; i++) {\n          let buttonStr = \"button\" + i;\n          if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].bigAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          } else if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].smallAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          }\n        }\n      }\n      \n      eventBus.subscribe('buttonChange', evalRageAttack, 'evalRageAttack');\n      \n\t}, // End startUp()\n\n    runCommand(suffix) {\n        let command = suffix;\n\t\t\n\t\tif (command.startsWith(\"remove prio\")) {\n\t\t\tlet enemyRemoval = command.slice(12);\n\t\t\tabash.currentArea = nexusclient.datahandler().GMCP.Location.area;\n\t\t\tlet enemyList = abash.prioList[abash.currentArea];\n\t\t\tlet enemyFound = false;\n\t\t\t\n\t\t\tenemyList.forEach(function(el) {\n\t\t\t\tif(el == enemyRemoval) {\n\t\t\t\t\tenemyFound = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tif (enemyFound) {\n\t\t\t\tlet enemyIndex = enemyList.indexOf(enemyRemoval);\n\t\t\t\tif (enemyIndex !== -1) {\n  \t\t\t\t\tenemyList.splice(enemyIndex, 1);\n\t\t\t\t\tabash.prioList[abash.currentArea] = enemyList;\n\t\t\t\t\tnexusclient.display_notice(\"Enemy removed from prio list\", \"green\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnexusclient.display_notice(\"Enemy not found in this area.\", \"red\");\n\t\t\t}\n\t\t} else if (command.startsWith(\"set attack\")) {\n\t\t\tlet newAttack = command.slice(11);\n\t\t\tabash.bashAttack = newAttack;\n\t\t\tabash.classAttacks[abash.myClass] = newAttack;\n\t\t\tnexusclient.variables().set(\"abashClassAttacks\", abash.classAttacks);\n\t\t} else {\n\n\t                switch (command) {\n\t\t\t\t\n\t\t\t\tcase \"help\":\n\t\t\t\t\tnexusclient.display_notice(\"ABash Help\", \"white\");\n\t\t\t\t\tnexusclient.display_notice(\"-----------------\", \"white\");\n\t\t\t\t\tnexusclient.display_notice(\"abash show prios here - list prio denizens in current area\", \"white\");\n\t\t\t\t\tnexusclient.display_notice(\" - click on red X to remove a denizen from the prio list\", \"white\");\n\t\t\t\t\tnexusclient.display_notice(\"abash set attack <attack> - Sets the bashing attack for your current class.\", \"white\");\n\t\t\t\t\tnexusclient.display_notice(\"*Note: if you're setting a multicommand attack you will need to change your commandseparator first, then set it back afterwards.\", \"white\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"show prios here\":\n\t\t\t\t\tabash.currentArea = nexusclient.datahandler().GMCP.Location.area;\n\t\t\t\t\tlet enemyList = abash.prioList[abash.currentArea];\n\t\t\t\t\tlet str = \"<span style='color:white'>Area: \" + abash.currentArea + \"</span>\\n\";\n\t\t\t\t\tstr += \"<span style='color:white'>-----------------</span>\\n\";\n\t\t\t\t\tenemyList.forEach(function(el) {\n\t\t\t\t\t\tstr += \"<span style='white'>[</span><span style='color:red' onClick='(function() { abash.runCommand(\\\"remove prio \" + el + \"\\\") })();'> X </span><span style='color:white'>] \" + el + \"</span>\\n\";\n\t\t\t\t\t});\n\t\t\t\t\tstr += \"<span style='color:white'>-----------------</span>\\n\";\n\t\t\t\t\tnexusclient.add_html_line(str);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tnexusclient.display_notice(\"Command not recognized.\", \"white\");\n\t\t\t}\n        }\n    },\n\n\tcommitAttack() {\n\t\tlet bashing = nexusclient.variables().get(\"bashing\");\n\n\t\tif(bashing) {\n\t\t\tnexusclient.datahandler().send_command(\"cq all \" + abash.separator + \" queue add free \" + abash.bashAttack);\n\t\t}\n\t}, // End commitAttack()\n\n}; // End of namespace\n\nabash.startUp();\n\nwindow.abash = abash;"},{"type":"alias","name":"ABash commands","enabled":true,"actions":[{"type":"script","enabled":true,"script":"//Enter the script here\nabash.runCommand(args[1]);"}],"text":"^abash (.+)","matching":"regexp","whole_words":true,"case_sensitive":false,"prefix_suffix":true},{"type":"function","name":"attackThings","enabled":true,"code":"//abash.attackThings = function() {\n\t\tlet roomItems = nexusclient.datahandler().GMCP.Items.room;\n\t\tabash.prioList = nexusclient.variables().get(\"basharrrPrioList\");\n\t\tabash.currentArea = nexusclient.datahandler().GMCP.Location.area;\n\t\tabash.myClass = GMCP.Status.class;\n\t\tlet enemyList = abash.prioList[abash.currentArea];\n\t\tlet enemyFound = false;\n\t\tlet bashing = nexusclient.variables().get(\"bashing\");\n\n\t\troomItems.forEach(function(el) {\n\t\t\tif(enemyList && enemyFound == false) {\n\t\t\t\tenemyList.forEach(function(el2) {\n\t\t\t\t\tif(el.name == el2) {\n\t\t\t\t\t\tenemyFound = true;\n\t\t\t\t\t\tnexusclient.datahandler().send_command(\"st \" + el.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (enemyFound == false || GMCP.RoomPlayers.length > 0) {\n\t\t\tnexusclient.display_notice(\"No enemies found\", \"green\");\n\t\t\tnexusclient.datahandler().send_command(\"st none\");\n\t\t\tnexusclient.variables().set(\"bashing\", false);\n          eventBus.raise('noEnemies');\n\t\t} else if (bashing == false) {\n\t\t\tnexusclient.variables().set(\"bashing\", true);\n\t\t\tnexusclient.datahandler().send_command(\"cq all \" + abash.separator + \" queue add free \" + abash.bashAttack);\n          // Attempt rage attack\n          for (let i = 2; i <= 7; i++) {\n          let buttonStr = \"button\" + i;\n          if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].bigAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          } else if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].smallAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          }\n        }\n          // End rage attack attempt\n\t\t} else {\n          nexusclient.datahandler().send_command(\"cq all \" + abash.separator + \" queue add free \" + abash.bashAttack);\n                    // Attempt rage attack\n          for (let i = 2; i <= 7; i++) {\n          let buttonStr = \"button\" + i;\n          if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].bigAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          } else if (GMCP.Buttons[buttonStr].text == rageTable[GMCP.Status.class].smallAttack) {\n            if(GMCP.Buttons[buttonStr].highlight == 1) {\n            \tsend_command(GMCP.Buttons[buttonStr].commands);\n              display_notice(\"You used \" + GMCP.Buttons[buttonStr].text + \"!!!\", \"orange\");\n            }\n          }\n        }\n          // End rage attack attempt\n        }\n\t//} // End attackThings()"},{"type":"alias","name":"","enabled":true,"actions":[{"type":"script","enabled":true,"script":"//Enter the script here\nlet bashing = get_variable(\"bashing\");\nif (!bashing) {\n  set_variable(\"bashing\", true);\n  if (!abash.separator) {\n    send_command(\"config commandseparator\");\n  }\n  abash.myClass = GMCP.Status.class;\n  console.log(\"GMCP class: \" + GMCP.Status.class);\n  console.log(\"ABash class set to: \" + abash.myClass);\n  if(abash.myClass in abash.classAttacks) {\n    abash.bashAttack = abash.classAttacks[abash.myClass];\n  } else {\n\tabash.bashAttack = \"kill\";\n  }\n  console.log(\"myClass: \" + abash.myClass);\n  console.log(\"ABash bashing attack: \" + abash.bashAttack);\n  run_function(\"attackThings\", {}, \"ABash\");\n  display_notice(\"It's BASHING TIME!!!\", \"orange\");\n} else {\n  set_variable(\"bashing\", false);\n  send_command(\"cq all\");\n  display_notice(\"Settle down there little fella\", \"orange\");\n}"}],"text":"ABashAttack","matching":"begins","whole_words":true,"case_sensitive":false,"prefix_suffix":true},{"type":"trigger","name":"Separator Catch","enabled":true,"actions":[{"type":"script","enabled":true,"script":"//Enter the script here\nabash.separator = args[1];"}],"text":"Your current separator is: (.+)","matching":"regexp","whole_words":true,"case_sensitive":true},{"type":"alias","name":"","enabled":true,"actions":[{"type":"function","enabled":true,"fn":"onLoad"}],"text":"abashreset","matching":"begins","whole_words":true,"case_sensitive":true,"prefix_suffix":true},{"type":"function","name":"__meta","enabled":true,"code":"{\n  \"version\": \"2.4.2\",\n  \"website\": \"https://github.com/EatyMeatyYum/abash\",\n  \"dependencies\": [\n    \"eventBus\",\n    \"eventBus events\"\n  ]\n}"}],"description":"Argwin's bashing system"}